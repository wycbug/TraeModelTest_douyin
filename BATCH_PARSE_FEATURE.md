# 批量解析功能开发需求文档

## 功能概述

实现智能批量解析功能，用户无需手动切换单个/批量模式。系统自动检测输入内容：

- 单行输入：按单条解析
- 多行输入：按批量解析（每行一个链接）

## 核心设计理念

### 用户体验优先

- 不提供“模式切换”控件，由系统自动判断
- 单一输入区，输入多少就解析多少
- 清晰、连续的反馈（校验、进度、结果、错误）
- 支持部分成功与部分失败的结果展示

### 原则性要求

- 前后端职责清晰，接口语义稳定
- 错误可感知、可恢复（重试与提示）
- 对用户输入进行最少约束但有明确边界（如批量上限）

---

## 详细功能需求

### 1. 前端输入与交互

1) 智能输入框
- 使用多行文本输入区域承载单条或多条链接
- 最小高度适配单行，内容增多时增高，超过阈值后滚动
- 占位文案：
  - 单行提示：“请输入抖音视频链接”
  - 多行提示：“已检测到多条链接，将自动进行批量解析（最多10条）”

2) 输入校验与提示
- 支持常见抖音链接格式，自动忽略空行
- 批量模式下统计“有效链接数量”，上限为10，超出时仅处理前10条并提示
- 无效输入时在输入框下方给出文字化原因（如“无效链接”/“请输入链接”）

3) 解析触发与状态
- 单一“解析”按钮，点击后进入加载态，不可重复点击
- 加载态显示“解析中…”，直至返回结果或失败
- 若是批量：展示整体进度百分比或“已完成/总数”

### 2. 解析逻辑（前端层面的交互）

- 自动识别输入为单条或多条
- 单条：直接请求后端单条解析接口
- 多条：按照行拆分，有效链接不超过10条，一次性请求后端批量接口
- 结果到达后：
  - 单条：渲染详细信息表
  - 批量：列表化展示每条结果的状态，成功项可查看摘要（作者、标题、封面缩略图）
- 将成功解析的记录写入本地历史，支持“查看详情”和“删除”单条

### 3. 后端 API 要求（文本化）

1) 单条解析端点
- 路径：/api/parse（GET）
- 参数：url（必填）
- 返回：状态码、消息、数据（作者、作者ID、标题、封面、无水印链接、音乐链接、头像、可选创建时间/时长/图片列表）

2) 批量解析端点（下一阶段实现）
- 路径：/api/batch（POST）
- 请求体：urls 数组（最多10条）
- 返回：每个 URL 对应的独立结果对象列表（包含原始 URL、状态码、消息、数据），允许部分失败

3) 通用要求
- 出错时返回明确的 code 与 msg，便于前端定位与提示
- 具备频率限制与重试机制，避免滥用与偶发失败

### 4. 结果展示（文字化规范）

1) 单条结果
- 使用“字段-值”的表格形式展示
- 图片类字段（封面、头像）以小尺寸缩略图方式呈现
- 链接类字段（无水印、音乐）支持“新开查看”和“一键复制”

2) 批量结果（下一阶段实现）
- 以列表逐条展示，包含：
  - 原始链接（可折叠或省略中间部分）
  - 状态（成功/失败）
  - 成功项的作者与标题摘要、封面缩略图
- 提供“仅导出成功项”功能，支持 CSV/Excel

### 5. 进度与反馈（文字化规范）

- 单条解析：按钮加载态 + 顶部/局部轻量提示
- 批量解析：在列表区域上方展示进度信息（如“3/8”），同时保持解析中按钮的加载态
- 任何错误均以红色提示条形式出现，文案简洁可读（例如：“链接无效，请检查后重试”）

### 6. 样式与观感（文字化规范）

- 整体风格清爽、对比明确，浅色背景 + 卡片化容器
- 输入区域：圆角、浅灰描边，聚焦时颜色加深并有轻微阴影
- 操作按钮：主色渐变、圆角、悬浮有轻微提升与阴影
- 图片缩略图：小圆角，悬浮略微放大
- 批量结果列表：卡片分隔、成功项以绿色强调、失败项以红色强调
- 错误提示：红色条幅，包含简短标题与说明

### 7. 错误处理（文字化规范）

- 输入错误：空输入、无效格式、超过上限
- 网络错误：请求失败、超时；引导用户重试
- 解析错误：单条失败不影响整体，批量允许部分失败并明确标注

### 8. 技术栈

前端：React + TypeScript + 原生 CSS。
后端：Cloudflare Workers（TypeScript，Fetch API）。
第三方：抖音解析 API（`https://api.pearktrue.cn/api/video/douyin/`）。
